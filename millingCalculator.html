<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Milling Calculator</title>
  <meta name="description" content="a calculator for your cnc settings">
  <meta name="author" content="Leo, Jens, Jakob et al">

</head>

<body>
  <script>
    let exampleInput = {
      materialToCut: "wood",
      millingBitDiameter: 4,
      numberOfFlutes: 1,
    }

    let presets6mm = {
      foam_or_wax: {
        chiploads: 0.3,
        passdepths: 19,
        rampAngle: 90,
      },
      wood: {
        chiploads: 0.2,
        passdepths: 16,
        rampAngle: 90,
      },
      hardwood: {
        chiploads: 0.133,
        passdepths: 12,
        rampAngle: 45,
      },
      plastic_roughing: {
        chiploads: 0.15,
        passdepths: 8,
        rampAngle: 18,
      },
      plastic_finishing: {
        chiploads: 0.073,
        passdepths: 8,
        rampAngle: 18,
      },
      aluminum_roughing: {
        chiploads: 0.12,
        passdepths: 1.8,
        rampAngle: 12,
      },
      aluminum_finishing: {
        chiploads: 0.06,
        passdepths: 1.8,
        rampAngle: 12,
      },
      steel_roughing: {
        chiploads: 0.08,
        passdepths: 0.6,
        rampAngle: 5,
      },
      steel_finishing: {
        chiploads: 0.04,
        passdepths: 0.6,
        rampAngle: 5,
      },
    }

    const output = (input, rpm, presets6mm, presetDiameter, plungRateReductionFactor) => {
      let {materialToCut, millingBitDiameter, numberOfFlutes} = input;

      let feedrate = (presets6mm[materialToCut].chiploads * rpm * numberOfFlutes * millingBitDiameter)/presetDiameter;
      let plungerate = feedrate * plungRateReductionFactor;

      let fluteReduction = 1-numberOfFlutes*.15;

      let passDepth = presets6mm[materialToCut].passdepths/presetDiameter*millingBitDiameter*(fluteReduction);
      let rampAngle = presets6mm[materialToCut].rampAngle;

      return {
        feedrate,
        plungerate,
        passDepth,
        rampAngle,
      };
    }

    const calculateSettings = (material, bitDiameter, numberOfFlutes, rpm, plungRateReductionFactor = 0.6) => {
      let input = {
        materialToCut: material,
        millingBitDiameter: bitDiameter,
        numberOfFlutes: numberOfFlutes,
      };

      return output(input, rpm, presets6mm, 6, plungRateReductionFactor);
    }

    let submit = () => {
      let material = document.getElementById("material").value;
      let bitDiameter = parseFloat(document.getElementById("bitDiameter").value);
      let flutes = parseFloat(document.getElementById("flutes").value);
      let rpm = parseFloat(document.getElementById("rpm").value);

      let set = calculateSettings(material, bitDiameter, flutes, rpm);

      document.getElementById("output").innerHTML = `
        Settings: <br>
        Feedrate: ${set.feedrate} mm/min <br>
        Plungerate: ${set.plungerate} mm/min <br>
        Pass Depth: ${set.passDepth} mm <br>
        Ramp Angle: ${set.rampAngle} degrees
      `
    }
  </script>

  <h2>Jens' Settings Provided to You with Leo's Code</h2>
  <form id="inputs">
    <select id="material">
      <option value="foam_or_wax">foam_or_wax</option>
      <option value="wood">wood</option>
      <option value="hardwood">hardwood</option>
      <option value="plastic_roughing">plastic_roughing</option>
      <option value="plastic_finishing">plastic_finishing</option>
      <option value="aluminum_roughing">aluminum_roughing</option>
      <option value="aluminum_finishing">aluminum_finishing</option>
      <option value="steel_roughing">steel_roughing</option>
      <option value="steel_finishing">steel_finishing</option>
    </select> <br>
    Bit Diameter: &nbsp <input type="number" id="bitDiameter"> &nbsp mm<br>
    Flutes: &nbsp <input type="number" id="flutes"> &nbsp<br>
    RPM: &nbsp <input type="number" id="rpm"> &nbsp<br>
  </form>
  <button type="submit" onClick="submit()">Submit</button>

  <br>
  <br>
  <div id="output"></div>
</body>
</html>

<!-- pass depth compensation -->
